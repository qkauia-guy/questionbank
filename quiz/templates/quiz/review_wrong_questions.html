{% extends "base.html" %}
{% load quiz_extras %}
{% block content %}
<div class="container mt-4">
  {% for record in records %}
    <div class="card my-3">
      <div class="card-header">
        <div class="text-muted">
          <span class="me-3">ğŸ—‚ é¡åˆ¥ï¼š{{ record.question.category }}</span>
          <span class="me-3">ğŸ“˜ ç« ç¯€ï¼š{{ record.question.chapter }} - {{ record.question.number }}</span>
        </div>
      </div>
      <div class="card-body">
        {{ record.question.question_text|safe_markdown_no_h1|safe }}

        <p class="mt-3">æ‰€æœ‰é¸é …ï¼š</p>
        <ul>
          {% for letter in "ABCDEFGH" %}
            {% with choice=record.question|get_choice:letter %}
              {% if choice and choice != "X" %}
                <li class="
                  {% if letter in record.question.answer|upper %}text-success{% endif %}
                  {% if letter in record.selected_answer|upper and letter not in record.question.answer|upper %}text-danger{% endif %}
                ">
                  {% if letter in record.question.answer|upper %}
                    æ­£ç¢ºç­”æ¡ˆ ğŸ…¥ 
                  {% elif letter in record.selected_answer|upper %}
                    ä½ é¸æ“‡çš„ç­”æ¡ˆ ğŸ…§ 
                  {% else %}
                    â˜‰
                  {% endif %}
                  <strong>{{ letter }}.</strong> {{ choice|safe_markdown_no_h1|safe }}
                </li>
              {% endif %}
            {% endwith %}
          {% endfor %}
        </ul>

        {% if record.ai_explanation %}
          <button class="btn btn-outline-info btn-sm mt-2" type="button"
                  data-bs-toggle="collapse" data-bs-target="#ai-explanation-{{ forloop.counter }}">
            â–¼ æŸ¥çœ‹ AI è£œå……èªªæ˜
          </button>
          <div class="collapse mt-2" id="ai-explanation-{{ forloop.counter }}">
            <div class="card card-body bg-light border">
              {{ record.ai_explanation|safe_markdown_no_h1|safe }}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p class="text-muted">å¤ªæ£’äº†ï¼ç›®å‰æ²’æœ‰éŒ¯é¡Œå¯è¤‡ç¿’ã€‚</p>
  {% endfor %}
</div>
{% endblock %}

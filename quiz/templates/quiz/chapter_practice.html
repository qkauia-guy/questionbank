{% extends "base.html" %}
{% load static %}
{% load quiz_extras %}
{% load markdown_deux_tags %}

{% block content %}

{% block extra_scripts %}
  <script src="{% static 'js/canvas-pen.js' %}" defer></script>
{% endblock %}

<!-- â¬†ï¸ å·¦ä¸Šè§’æµ®å‡ºç§’æ•¸ -->
<div id="floating-timer">
  ä½œç­”æ™‚é–“ï¼š<span id="timer">0</span> ç§’
</div>

  <div class="mb-3 text-muted mt-3">
    {% if category and category != "None" %}
      <span class="me-3">ğŸ—‚ ç§‘ç›®ï¼š{{ question.category }}</span>
    {% endif %}
    {% if question %}
      <span class="me-3">ğŸ“˜ ç« ç¯€ï¼š{{ question.chapter }} - {{ question.number }}</span>
    {% endif %}
  </div>

  {% if category_total %}
    <div class="progress mb-3 position-relative" style="height: 20px; background-color: #444;">
      <div class="progress-bar"
           role="progressbar"
           data-width="{{ current_index|add:1|div:category_total|mul:100|floatformat:0 }}"
           style="width: 0%; background-color: rgba(255, 255, 255, 0.25);">
      </div>
      <div class="progress-label">
        ç¬¬ {{ current_index|add:1 }} é¡Œ / å…± {{ category_total }} é¡Œ
      </div>
    </div>
  {% endif %}

<!-- ç§‘ç›®æœªé¸æ“‡æç¤º -->
{% if not category or category == "None" %}
  <div class="alert alert-warning mt-3" role="alert">
    âš ï¸ è«‹å…ˆé¸æ“‡ç§‘ç›®å¾Œå†é–‹å§‹ç·´ç¿’ã€‚
  </div>
{% elif question %}
  <!-- âœ… é¡Œç›®å¡ç‰‡ï¼šå…±ç”¨ _question_card.htmlï¼Œé–‹å•Ÿ restart + è¿½å•åŠŸèƒ½ -->
  {% include 'quiz/_question_card.html' with show_restart=True allow_followup=True %}
{% endif %}

<!-- é€²åº¦æ¢å‹•ç•«æ•ˆæœ -->
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const bar = document.querySelector(".progress-bar");
    if (bar) {
      const targetWidth = bar.getAttribute("data-width");
      setTimeout(() => {
        bar.style.width = `${targetWidth}%`;
      }, 100);
    }
  });
</script>

<!-- ç–ŠåŠ ç•«å¸ƒ -->
{% include 'quiz/_overlay_canvas.html' %}

<!-- æœå°‹æ¬„ -->
{% include 'quiz/_search_mock_exam.html' %}

{% endblock %}

{% extends "base.html" %}
{% load quiz_extras %}
{% load markdown_deux_tags %}

{% block content %}
<div class="container my-4">
  <h5 class="mb-3">üìù ITS Ê®°Êì¨ËÄÉ</h5>

  <div class="mb-2 text-muted">
  Á¨¨ {{ current_index|add:1 }} È°å / ÂÖ± {{ total_question_count }} È°å
</div>
  <div id="floating-timer">
    <big>‚è±</big> ‰ΩúÁ≠îÊôÇÈñìÔºö<span id="timer">0</span> Áßí
  </div>

<div class="progress mb-4" style="height: 20px;">
  <div class="progress-bar"
       role="progressbar"
       style="width: {{ progress }}%;"
       aria-valuenow="{{ current_index|add:1 }}"
       aria-valuemin="0"
       aria-valuemax="{{ total_question_count }}">
    {{ progress }}%
  </div>
</div>

  <div class="question-card">
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="question_id" value="{{ question.id }}" />
      <input type="hidden" name="used_time" id="used_time" value="0" />

      {% if question.image %}
        <div class="mb-3">
          <img
            src="{{ question.image.url }}"
            alt="È°åÁõÆÈôÑÂúñ"
            style="max-width: 100%; border: 1px solid #ccc; border-radius: 8px" />
        </div>
      {% endif %}

      <div class="mb-3">
        {{ question.question_text|safe_markdown_with_lang:question.category|safe }}
      </div>

      {% for option in "ABCDEFGH" %}
        {% with choice=question|get_choice:option %}
          {% if choice and choice != "X" %}
            <!-- {% include "quiz/_choice_block.html" with choice=choice option=option %} -->
            {% include "quiz/_choice_block.html" with choice=question|get_choice:option option=option %}
          {% endif %}
        {% endwith %}
      {% endfor %}

      {% if question.is_fill_in %}
        <div class="mb-3">
          <label for="fill_answer" class="form-label">Ëº∏ÂÖ•Á≠îÊ°àÔºö</label>
          <input
            type="text"
            class="form-control"
            name="fill_answer"
            id="fill_answer" />
        </div>
      {% endif %}

      <div class="d-flex justify-content-between align-items-center mt-4">
        <a
          href="{% url 'exam_start' %}?category={{ question.category }}"
          class="btn btn-outline-secondary">
          Èõ¢ÈñãËÄÉË©¶
        </a>
        <button type="submit" class="btn btn-primary">
          ‰∏ã‰∏ÄÈ°å ‚û°Ô∏è
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
